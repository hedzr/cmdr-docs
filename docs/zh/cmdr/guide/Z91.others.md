---
layout: single
title: "å…¶å®ƒç‰¹æ€§ (Others)"
date: 2020-07-13 11:35:11 +0800
last-modified: 2020-08-17 12:52:01 +0800
Author: hedzr
tags: [commander, command-line, "command-line-parser", command-line-interface,  getops, posix, posix-compatible, hierarchical-configuration, hierarchy, cli, golang]
categories: golang cmdr guide envvars
comments: true
toc: true
header:
  overlay_image: /assets/images/cmdr/help-screen.png
  overlay_filter: rgba(128, 128, 0, 0.3)
excerpt: >-
  Guide and References for cmdr ...
#header:
#  overlay_image: /assets/images/unsplash-image-1.jpg
#  overlay_filter: rgba(0, 0, 0, 0.15)
#  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
#  actions:
#    - label: "More Info"
#      url: "https://unsplash.com"


---



# Others



## Addons

### Using `isdelve`

isdelve å‡ ä¹è¢«å†…ç½®äº `cmdr` ä¸­ã€‚

å‡ ä¹ï¼Œæ˜¯æŒ‡å¦‚æœä½ ä¼šä½¿ç”¨åˆ°å‡ ä¸ªç‰¹åˆ«çš„ API è°ƒç”¨çš„è¯ï¼Œåˆ™ isdelve ä¼šè¢«è‡ªåŠ¨åœ°å¼•ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œå¦åˆ™å³ä½¿ä½ ä½¿ç”¨äº† cmdr ä¹Ÿä¸ä¼šè‡ªåŠ¨åŒ…å« isdelve çš„ç›¸å…³å†…å®¹ã€‚è¿™å‡ ä¸ªç‰¹åˆ«è°ƒç”¨æ˜¯ï¼š

1. `cmdr.InDebugging() bool`
2. `cmdr.IsDebuggerAttached() bool`

isdelve æä¾›çš„æ£€æµ‹å‡½æ•°ï¼Œç›®çš„åœ¨äºæ£€æµ‹ dlv è°ƒè¯•å™¨æœ‰å¦åœ¨çº¿ã€‚å¦‚æœä½ çš„ app è¢«å¯ç”¨äºä¸€ä¸ª dlv å…¼å®¹çš„è°ƒè¯•å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆä¸Šè¿°æ£€æµ‹ä¼šè¿”å› true å€¼ã€‚

å¦‚åŒè¿™é‡Œæ‰€è®²çš„é‚£æ ·ä½¿å¾— isdelve èƒ½å¤Ÿç”Ÿæ•ˆï¼š

https://stackoverflow.com/questions/47879070/how-can-i-see-if-the-goland-debugger-is-running-in-the-program

> In Goland, you can enable this under 'Run/Debug Configurations', by adding the following into 'Go tool arguments:'
>
> ```golang
> -tags=delve
> ```
>
> [![Goland Run/Debug Configurations window](https://i.stack.imgur.com/fPKA2.png)](https://i.stack.imgur.com/fPKA2.png)
>
> ------
>
> If you are outside of Goland, running `go run a.go` will report `delve false`, if you want to run dlv on its own, use `dlv debug --build-flags='-tags=delve' a.go`; this will report `delve true`.





#### å’Œ IsDebugMode() çš„åŒºåˆ«

`IsDebugMode() bool` çš„åŠŸèƒ½æ˜¯æµ‹è¯• `cmdr.GetBoolR("debug")` æ˜¯å¦è¢«ç½®ä½ã€‚è¦è®¾ç½®è¿™ä¸ªæ ‡å¿—ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ `--debug/-D`ï¼Œè¿™æ˜¯åœ¨ cmdr ä¸­å†…å»ºçš„éš¶å±äº RootCommand çš„æ ‡å¿—ï¼Œç›®çš„å°±åœ¨äºé¢„ç½®ä¸€ä¸ªå…¨å±€çš„ `è°ƒè¯•æ¨¡å¼`ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€è°“çš„ `è°ƒè¯•æ¨¡å¼` å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿè¾“å‡ºæ›´å¤šçš„ app è¿è¡Œè¿‡ç¨‹ä¸­é¢„åŸ‹çš„è°ƒè¯•æ—¥å¿—ï¼Œå¦‚æœä½ ä½¿ç”¨äº† logx é›†æˆï¼ˆè¿™æ˜¯æˆ‘ä»¬æä¾›çš„ä¸€ä¸ªç”¨äºæ•´åˆ cmdr å’Œ hedzr/log çš„é™„åŠ åº“ï¼‰ï¼Œé‚£ä¹ˆ `cmdr.Logger.Debugf(...)` å°†ä¼šåœ¨ `--debug` ä¸º true æ—¶è‡ªåŠ¨è¢«è¾“å‡ºã€‚

> See also: `WithLogx()`



#### `--debug` vs `~~debug`

è¦æ³¨æ„çš„æ˜¯ï¼Œ`--debug` æ˜¯éš¶å±äº RootCommand çš„å‘½ä»¤è¡Œæ ‡å¿—ï¼Œå®ƒå’Œ `~~debug` ä¹Ÿæœ‰æ‰€ä¸åŒã€‚

`~~debug` é‡‡ç”¨ cmdr ç‰¹æœ‰çš„æ ‡å¿—å‰ç¼€ `~~`ï¼Œè¿™ä¼šè®¾ç½®ä¸€ä¸ªåœ¨ Option Store ä¸­çš„ `debug` é…ç½®é¡¹ï¼Œè€Œ `--debug` ä¼šè®¾ç½®çš„æ˜¯ Option Store ä¸­çš„ `app.debug` é…ç½®é¡¹ã€‚

æ‰€ä»¥é€šè¿‡ `cmdr.GetBoolR("debug")` ï¼ˆæˆ–è€…ä½¿ç”¨ `cmdr.GetDebugMode()`ï¼‰èƒ½å¤Ÿè·å–åˆ° `--debug` çš„é…ç½®å€¼ï¼Œä½†ä½ æ— æ³•é€šè¿‡ cmdr.GetBoolR() çš„æ–¹å¼å–å¾— `~~debug` çš„å€¼ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä½ åº”è¯¥ç”¨ `cmdr.GetBool("debug")` æ¥è·å– `~~debug` çš„é…ç½®å€¼ã€‚

> GetBool(keyPath) ç›´æ¥å–å¾— keyPath å¯¹åº”çš„é…ç½®é¡¹çš„å€¼ã€‚
>
> GetBoolR(keyPath) é¦–å…ˆä¸º keyPath æ·»åŠ æ‰€è°“çš„ OptionsPrefix å‰ç¼€ï¼Œç„¶åå†å–å¾—æ–°çš„ keyPath æ‰€å¯¹åº”çš„é…ç½®é¡¹çš„å€¼ã€‚
>
> é»˜è®¤çš„ OptionsPrefix ä¸º "app"ã€‚





### Using `dex`

(TODO)





## ä» go flag è¿ç§»

è¯·å‚è€ƒï¼š

 [ä» flag è¿ç§»åˆ° cmdr | hzSomthing](https://hedzr.github.io/golang/cmdr/others/cmdr-migrating-from-flag/) 



## ä½¿ç”¨ flag ç­‰ä»·çš„å‘½ä»¤è¡Œç•Œé¢

æˆ‘ä»¬å·²ç»ç†ŸçŸ¥ golang æå€¡çš„æ˜¯çŸ­é€‰é¡¹ç±»ä¼¼çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œæ¯ä¸ªé€‰é¡¹å‡ä»¥çŸ­æ¨ªçº¿å¼•å¯¼ï¼Œé€‰é¡¹è¢«å»ºè®®é‡‡ç”¨å®Œæ•´çš„å•è¯è€Œä¸æ˜¯ç¼©ç•¥è¯­ã€‚æ‰€ä»¥å½“ä½ ä½¿ç”¨ flag æ—¶ï¼Œä¸€ä¸ª app çš„é€‰é¡¹åˆ—è¡¨å¾€å¾€æ˜¯è¿™æ ·çš„é£æ ¼ï¼š

```bash
Usage of flagdemo:
  -age int
    	Input Your Age (default 28)
  -flagname int
    	Just for demo (default 1234)
  -gender string
    	Input Your Gender (default "male")
  -name string
    	Input Your Name (default "nick")
```

å…¶æºç å¯ä»¥å‚è€ƒè¿™é‡Œï¼š

<https://play.golang.org/p/9I0ZcqJ_oRs>





### ç”¨ cmdr æ¥æ¨¡æ‹Ÿ

ç”±äº cmdr å…è®¸çŸ­é€‰é¡¹ä¸å¿…è¢«é™åˆ¶ä¸ºå•ä¸ªå­—æ¯ï¼Œæ•…è€Œå½“ä½ ä¸æ„¿é‡‡ç”¨æ ‡å‡†çš„ POXIS CLI ç•Œé¢ï¼Œè€Œæ˜¯æƒ³æ²¿å¾ª Golang æƒ¯ä¾‹æ—¶ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿåšåˆ°çš„ã€‚

```go
package main

import (
	"fmt"
	"github.com/hedzr/cmdr"
)

func main() {
	if err := cmdr.Exec(buildRootCmd(),
	); err != nil {
		fmt.Printf("error: %+v\n", err)
	}
}

func buildRootCmd() (rootCmd *cmdr.RootCommand) {
	root := cmdr.Root(appName, version).
		Copyright(copyright, "hedzr").
		Description(desc, longDesc).
		Examples(examples)
	rootCmd = root.RootCommand()

	cmdr.NewInt(28).
		Titles("age", "age").
		Description("Input Your Age").
		AttachTo(root)

	cmdr.NewInt(1234).
		Titles("flagname", "flagname").
		Description("Just for demo").
		AttachTo(root)

	cmdr.NewString("male").
		Titles("gender", "gender").
		Description("Input Your Gender").
		AttachTo(root)

	cmdr.NewString("nick").
		Titles("name", "name").
		Description("Input Your Name").
		AttachTo(root)

	return
}

const (
	appName   = "flag-demo"
	version   = "1.0.0"
	copyright = "flag-demo is an effective devops tool"
	desc      = "flag-demo is an effective devops tool. It make an demo application for `cmdr`."
	longDesc  = "flag-demo is an effective devops tool. It make an demo application for `cmdr`."
	examples  = ``
)
```



å…¶ç•Œé¢å½¢å¦‚ä¸‹é¢çš„è¾“å‡ºï¼š

![image-20200724131056493](https://i.loli.net/2020/07/24/wgFbJzSMeYZ1XNy.png)



å¯ä»¥è§åˆ°ï¼Œå€ŸåŠ© cmdr çš„å¢å¼ºçš„çŸ­é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å’Œ flag å®Œå…¨ç­‰ä»·çš„ CLI ç•Œé¢ã€‚









## MetaData at Go Building

åœ¨ä½¿ç”¨ cmdr æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ Golang çš„æ„å»ºè¿‡ç¨‹æ’å…¥ä¸€äº›å…ƒä¿¡æ¯ï¼Œè¿™æ ·å°†ä¼šæœ‰åˆ©äº cmdr çš„åŸºç¡€ä¿¡æ¯å®Œå¤‡ã€‚

æˆ‘ä»¬å»ºè®®ä½ é‡‡ç”¨å¦‚ä¸‹çš„è¿‡ç¨‹æ¥è¿›è¡Œå‘å¸ƒç‰ˆæœ¬çš„æ„å»ºï¼š

```bash
APP_NAME=your-app-name
APP_VERSION=your-app-version

CMDR_PKG=github.com/hedzr/cmdr/conf

TIMESTAMP=$(date -u '+%Y-%m-%d_%I:%M:%S%p')
GITHASH=$(git rev-parse HEAD)
GOVERSION=$(go version)

LDFLAGS="-s -w -X '$CMDR_PKG.Buildstamp=$TIMESTAMP' -X '$CMDR_PKG.Githash=$GITHASH' -X '$CMDR_PKG.GoVersion=$GOVERSION' -X '$CMDR_PKG.Version=$APP_VERSION' -X '$CMDR_PKG.AppName=$APP_NAME"

go build -ldflags "$LDFLAGS" -o bin/app-name ./cli
```

ä½ ä¸å¿…æ— è„‘æ‹·è´ï¼Œåªéœ€è¦çŸ¥é“åœ¨ `$CMDR_PKG` ä¸­ï¼Œcmdr çº¦å®šäº†ä¸€ç»„å…ƒä¿¡æ¯å˜é‡ï¼Œå‘å®ƒä»¬æä¾›æ­£ç¡®çš„å€¼å°†ä¼šæœ‰åˆ©äº cmdr çš„è¿ä½œã€‚ä¾‹å¦‚ cmdr åœ¨è¾“å‡ºåº”ç”¨åç§°æ ‡é¢˜è¡Œæ—¶ï¼Œæˆ–è€…é€šè¿‡ `--version` æ‰“å°ç‰ˆæœ¬å·æ—¶ï¼Œé€šè¿‡ `--build-info` æ‰“å°æ„å»ºä¿¡æ¯å±æ—¶ï¼Œéƒ½ä¼šç”¨åˆ°ä¸Šè¿°çš„å…ƒä¿¡æ¯ã€‚

æ‰€ä»¥åœ¨æ„å»ºä½ çš„ app æ—¶ï¼Œä½ åº”è¯¥é€šè¿‡ CI å·¥å…·æ¥å®Œæˆè¿™äº›ä¿¡æ¯çš„ç»„ç»‡ï¼Œå°½ç®¡è¿™äº›å˜é‡ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼å»è®¾ç½®ã€‚ä½†åˆä½•å¿…å‘¢ï¼Ÿç™½ç™½æŸå¤±å¯åŠ¨é€Ÿåº¦ï¼Œå³ä½¿åªæ˜¯å‡ å ns ä¹Ÿæ²¡å¿…è¦ã€‚











ğŸ”š



