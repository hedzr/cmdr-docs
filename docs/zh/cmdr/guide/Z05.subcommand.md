---
layout: single
title: "å­å‘½ä»¤ (Subcommands)"
date: 2020-07-13 11:17:11 +0800
Author: hedzr
tags: [commander, command-line, "command-line-parser", command-line-interface,  getops, posix, posix-compatible, hierarchical-configuration, hierarchy, cli, golang]
categories: golang cmdr guide subcommand
comments: true
toc: true
header:
  overlay_image: /assets/images/cmdr/help-screen.png
  overlay_filter: rgba(128, 128, 0, 0.41)
excerpt: >-
  Guide and References for cmdr ...
#header:
#  overlay_image: /assets/images/unsplash-image-1.jpg
#  overlay_filter: rgba(0, 0, 0, 0.15)
#  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
#  actions:
#    - label: "More Info"
#      url: "https://unsplash.com"


---



## Subcommands

### ç®€å• CLI

ä¸€ä¸ªç®€å•çš„ CLI åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ `wget`ï¼Œå¹¶ä¸éœ€è¦å®šä¹‰å­å‘½ä»¤ã€‚æ‰€ä»¥è¿™æ ·çš„åº”ç”¨ç¨‹åºåªéœ€è¦ä¸€ä¸ª `RootCommand` å°±å¤Ÿäº†ï¼š

```go
func buildRootCmd() (rootCmd *cmdr.RootCommand) {
	root := cmdr.Root("wget-cover", wgetVersion).
		Header(`GNU Wget 1.20, a non-interactive network retriever.

Usage: wget [OPTION]... [URL]...

Mandatory arguments to long options are mandatory for short options too.`).
		Description("", "").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			return
		})
	rootCmd = root.RootCommand()

	setStartupFlags(root)
  setLoggerFlags(root)
	// ...
	return
}

func setStartupFlags(root cmdr.OptCmd) {
	cmdr.NewBool().
		Titles("version", "V").
		Description("display the version of Wget and exit").
		Group(cStartup).
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			cmd.PrintVersion()
			return cmdr.ErrShouldBeStopException
		}).
		AttachTo(root)
	cmdr.NewBool().
		Titles("help", "h").
		Description("print this help screen").
		Group(cStartup).
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			// cmd.PrintHelp(false)
			return
		}).
		AttachTo(root)
	cmdr.NewBool().
		Titles("background", "b", "bg").
		Description("go to background after startup").
		Group(cStartup).
		AttachTo(root)
	cmdr.NewString().
		Titles("execute", "e").
		Description("execute a `.wgetrc'-style command").
		Placeholder("COMMAND").
		Group(cStartup).
		AttachTo(root)
}

func setLoggerFlags(root cmdr.OptCmd) {
	cmdr.NewString().
		Titles("append-output", "a").
		Name("011.append-output").
		Description("append messages to FILE").
		Placeholder("FILE").
		Group(cLogging).
		AttachTo(root)
	cmdr.NewString().
		Titles("output-file", "o").
		Name("001.output-file").
		Description("log messages to FILE").
		Placeholder("FILE").
		Group(cLogging).
		AttachTo(root)
}
```



å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ `cmdr.Root()` ä»¥åŠçº§è”çš„ `Description()`ï¼Œ`Action` ç­‰å‡½æ•°è°ƒç”¨æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª `*cmdr.RootCommand` å¯¹è±¡ã€‚

Action å‡½æ•°å°†ä¼šæä¾›ä¸€ä¸ªå“åº”å‡½æ•°ã€‚å½“ `wget-cover` è¢«è¿è¡Œæ—¶ï¼Œè¿™ä¸ªå“åº”å‡½æ•°å°†ä¼šè·å¾—æ§åˆ¶æƒã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦å®šä¹‰äº† Action å‡½æ•°ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºè¿è¡Œæ—¶å°±ä¸ä¼šè‡ªåŠ¨æ˜¾ç¤ºå¸®åŠ©å±äº†ï¼Œé™¤éä½ ä½¿ç”¨ `wget-cover --help` ï¼ˆæˆ–è€… `-h`, `-?` ç­‰ï¼‰ç­‰æ–¹å¼ï¼ˆè¿™ä¹Ÿæ˜¯ POSIX å…¼å®¹çš„æ–¹æ¡ˆï¼‰ã€‚

#### å…³äº PreAction å’Œ PostAction

å¯¹äº RootCommand æ¥è¯´ï¼Œé™¤äº†èƒ½å¤Ÿå®šä¹‰åº”ç”¨ç¨‹åºçº§åˆ«çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ appNameï¼Œversionï¼Œbanner ç­‰ç­‰ä¹‹å¤–ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯å®ƒçš„ PreAction å’Œ PostAction å‡½æ•°äº†ã€‚åœ¨ RootCommand çš„  Action å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰å’Œä¹‹åï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¼šåˆ†åˆ«è·å¾—æ‰§è¡Œæ§åˆ¶æƒã€‚

å®ƒä»¬çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå¯¹äºå­å‘½ä»¤çš„ Action å‡½æ•°è¢«æ‰§è¡Œçš„æƒ…å†µï¼Œé™¤äº†å­å‘½ä»¤çš„ PreAction å’Œ PostAction ä¼šæœ‰æœºä¼šè¢«æ‰§è¡Œä¹‹å¤–ï¼ŒRootCommand çš„ PreAction å’Œ PostAction ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚æ‰€ä»¥å®ƒä»¬éšå«ç€å…¨å±€çš„å‰ç½®å’Œåç½®è°ƒç”¨çš„å«ä¹‰ã€‚

#### å…³äºæ’åº

å­å‘½ä»¤/æ ‡å¿— éƒ½æ˜¯å¯ä»¥æ’åºçš„ã€‚

åœ¨é»˜è®¤æ—¶ï¼Œå­å‘½ä»¤/æ ‡å¿— æŒ‰ç…§å®ƒä»¬çš„ Long/Full æ ‡é¢˜å­—ç¬¦ä¸²çš„ ASCII å­—æ¯æ•°å­—é¡ºåºè¢«æ˜¾ç¤ºåœ¨å¸®åŠ©å±ä¸­ï¼ˆæ‰€ä»¥æ·»åŠ é¡ºåºä¸é‡è¦ï¼‰ã€‚ä½†é€šè¿‡ Name() åœ¨æŒ‡å®šä¸€ä¸ªå­å‘½ä»¤/æ ‡å¿— çš„å†…éƒ¨åç§°çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªæ’åºç”¨çš„å‰ç¼€ã€‚å¦‚åŒ `Name("011.append-output")` è¿™æ ·ã€‚

è¿™ä¸ªå‰ç¼€ `011` ä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œä½†ä¼šå½±å“åˆ°å­å‘½ä»¤/æ ‡å¿— çš„æ˜¾ç¤ºé¡ºåºã€‚å°±åƒè¿™æ ·ï¼š

![image-20200713221103126](https://i.loli.net/2020/07/13/wWCtVsLJyE9zToj.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° `--output-file` å’Œ `--append-output` çš„é¡ºåºè¢«å®šåˆ¶è¿‡äº†ã€‚

æ’åºç”¨çš„å‰ç¼€ï¼Œå¯ä»¥æ˜¯è‹±æ–‡å­—æ¯å’Œé˜¿æ‹‰ä¼¯æ•°å­—çš„ç»„åˆï¼Œå®ƒä»¬å°†è¢«ä¾ç…§ ASCII å­—ç¬¦ä¸²æ¯”è¾ƒå¤§å°çš„æ–¹å¼æ¥å½±å“åˆ°å¯¹åº”æ¡ç›®çš„é¡ºåºã€‚åƒ `zzzz.`ï¼Œ`zzz9`.ï¼Œ`1234.` ç­‰éƒ½æ˜¯æœ‰æ•ˆçš„å‰ç¼€ã€‚

å‰ç¼€å’Œå¸¸è§„åç§°ä¹‹é—´ä»¥å¥ç‚¹åˆ†éš”ã€‚

åŒæ ·çš„ç­–ç•¥ï¼Œè¿˜è¢«åº”ç”¨åœ¨ Group() ä¸Šï¼Œä»è€Œå¯ä»¥å½±å“åˆ° å­å‘½ä»¤åˆ†ç»„ã€æ ‡å¿—åˆ†ç»„çš„é¡ºåºã€‚







### å¸¦æœ‰å­å‘½ä»¤çš„ CLI

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å®šä¹‰å‡ºåƒ docker é‚£æ ·çš„å¤šçº§å‘½ä»¤ç»“æ„ã€‚ä»ç†è®ºä¸Šè¯´ï¼Œç€æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œä½ å¯ä»¥æ— é™åœ°å®šä¹‰å¤šçº§å­å‘½ä»¤ã€‚

è¿™æ˜¯é€šè¿‡ `command.NewSubCommand()` çš„æ–¹å¼æ¥å®ç°çš„ã€‚ä» rootCmd å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ï¼š

```go
	root := cmdr.Root(appName, cmdr_examples.Version).
		Copyright(copyright, "hedzr").
		Description(desc, longDesc).
		Examples(examples)
	rootCmd = root.RootCommand()

	root.NewSubCommand("soundex", "snd", "sndx", "sound").
		Description("soundex test").
		Group("Test").
		TailPlaceholder("[text1, text2, ...]").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			for ix, s := range args {
				fmt.Printf("%5d. %s => %s\n", ix, s, cmdr.Soundex(s))
			}
			return
		})

	pa := root.NewSubCommand("panic-test", "pa").
		Description("test panic inside cmdr actions", "").
		Group("Test")

	val := 9
	zeroVal := zero

  dz := pa.NewSubCommand("division-by-zero", "dz").
		Description("").
		Group("Test").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			fmt.Println(val / zeroVal)
			return
		})

	cmdr.NewBool(false).
		Titles("enable-abc", "abc").
		AttachTo(dz)

	pa.NewSubCommand("panic", "pa").
		Description("").
		Group("Test").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			panic(9)
			return
		})
```

ä¸Šé¢çš„ä»£ç å»ºç«‹äº†è¿™æ ·çš„å­å‘½ä»¤ç»“æ„ï¼š

```bash
â¯ go run ./examples/simple/ ~~tree
ROOT
  snd, soundex, sndx, sound - soundex test
  pa, panic-test - test panic inside cmdr actions
    dz, division-by-zero - 
    pa, panic - 
  g, generate, gen - generators for this app.
    s, shell, sh - generate the bash/zsh auto-completion script or install it.
    m, manual, man - generate linux man page.
    d, doc, markdown, pdf, docx, tex - generate a markdown document, or: pdf/TeX/...
```



æ³¨æ„ `generate` åŠå…¶å­å‘½ä»¤æ—¶å†…ç½®çš„ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ `cmdr.WithBuiltinCommands()` æ¥ç¦æ­¢å‡ ç»„å†…ç½®å‘½ä»¤é›†åˆè¢«è‡ªåŠ¨ç»„åˆåˆ°ä½ çš„åº”ç”¨ç¨‹åºä¸­å»ï¼š

```go
func main() {
	if err := cmdr.Exec(buildRootCmd(),
		// To disable internal commands and flags, uncomment the following codes
		cmdr.WithBuiltinCommands(false, false, false, false, true),
	); err != nil {
		log.Fatalf("Error: %v", err)
	}
}
```



å‰é¢æˆ‘ä»¬å·²ç»æåˆ°è¿‡ï¼Œåœ¨å­å‘½ä»¤çš„ Action å‡½æ•°è¢«æ‰§è¡Œçš„æƒ…å†µï¼Œé™¤äº†å­å‘½ä»¤çš„ PreAction å’Œ PostAction ä¼šæœ‰æœºä¼šè¢«æ‰§è¡Œä¹‹å¤–ï¼ŒRootCommand çš„ PreAction å’Œ PostAction ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚

æ‰€ä»¥ RootCommand çš„ PreAction å’Œ PostAction å®é™…ä¸Šéšå«ç€å…¨å±€çš„å‰ç½®å’Œåç½®è°ƒç”¨çš„å«ä¹‰ã€‚



#### å…³äºæ ‡é¢˜

å­å‘½ä»¤çš„ Short çŸ­æ ‡é¢˜ã€åˆ«å Alias æ ‡é¢˜ï¼Œå’Œé•¿ Long/Full æ ‡é¢˜å…·æœ‰ç›¸åŒçš„å«ä¹‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ··ç”¨å®ƒä»¬ã€‚

#### å…³äºé•¿æ ‡é¢˜å’Œ keyPath

ä½†ä»¥åæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå­å‘½ä»¤ä»¥åŠæ ‡å¿—çš„é•¿æ ‡é¢˜éå¸¸é‡è¦ï¼Œå®ƒä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”ä¼šåœ¨ cmdr å†…éƒ¨è¢«ç”¨ä½œç´¢å¼•å…³é”®å­—æ¥æ ‡è¯†ä¸€ä¸ªå­å‘½ä»¤å¯¹è±¡ã€‚

å¯¹äº `division-by-zero` è¿™æ¡å­å‘½ä»¤æ¥è¯´ï¼Œå®ƒçš„ keyPath ä¸º `app.panic-test.division-by-zero`ï¼Œå…¶ä¸­ `app` æ˜¯å†…ç½®çš„å‰ç¼€ï¼ˆOptionPrefixï¼‰ï¼Œå¯ä»¥è¢« `cmdr.WithOptionPrefix()` æ‰€ä¿®æ”¹ã€‚

å¯¹äº `division-by-zero` ä¸“å±çš„æ ‡å¿— `enable-abc` æ¥è¯´ï¼Œå…¶ keyPath ä¸º `app.panic-test.division-by-zero.enable-abc`ï¼Œä¹Ÿå°±æ˜¯æ‰€å±å­å‘½ä»¤çš„ keyPath åŠ ä¸Šæ ‡å¿—è‡ªèº«çš„é•¿æ ‡é¢˜ä»¥æ„æˆã€‚æ ‡å¿—çš„ keyPath è¢«ç”¨åœ¨ `cmdr.GetXXX(`) å‘½ä»¤æ—ä¸­ä»¥è®¿é—®è¯¥æ ‡å¿—çš„å…·ä½“å€¼ã€‚

ä¾‹å¦‚ï¼š`cmdr.GetBoolR("panic-test.division-by-zero.enable-abc")` å¯ä»¥å–å¾— `enable-abc` çš„å€¼ã€‚å¦‚æœä½ åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨äº† `--enable-abc`ï¼Œé‚£ä¹ˆGetBoolRä¼šä¸ºå…¶è¿”å› trueã€‚

> å¸¦æœ‰ R åç¼€çš„ GetXXX å‘½ä»¤è¦æ±‚ä½ æä¾›çš„ keyPath ä¸å¿…åŒ…å«æ‰€è°“çš„ OptionPrefixï¼Œæ‰€ä»¥ `cmdr.GetBoolR("panic-test.division-by-zero.enable-abc")` å®é™…ä¸Šæ˜¯ç­‰æ•ˆäº `cmdr.GetBool("app.panic-test.division-by-zero.enable-abc")` çš„ã€‚

> å¸¦æœ‰ P åç¼€çš„ GetXXX å‘½ä»¤è¦æ±‚ä½ åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†æ¥æä¾› keyPathï¼Œæ‰€ä»¥ `cmdr.GetBoolRP("panic-test.division-by-zeroâ€œ, "enable-abc")` æ˜¯å’Œ `cmdr.GetBool("app.panic-test.division-by-zero.enable-abc")` ç­‰æ•ˆçš„ã€‚









## ğŸ”š



