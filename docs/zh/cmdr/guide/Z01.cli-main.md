---
layout: single
title: "CLI App ä»£ç å¸ƒå±€"
date: 2020-07-13 11:16:11 +0800
Author: hedzr
tags: [commander, command-line, "command-line-parser", command-line-interface,  getops, posix, posix-compatible, hierarchical-configuration, hierarchy, cli, golang]
categories: golang cmdr guide cli
comments: true
toc: true
header:
  overlay_image: /assets/images/cmdr/help-screen.png
  overlay_filter: rgba(128, 128, 0, 0.3)
excerpt: >-
  Guide and References for cmdr ...
#header:
#  overlay_image: /assets/images/unsplash-image-1.jpg
#  overlay_filter: rgba(0, 0, 0, 0.15)
#  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
#  actions:
#    - label: "More Info"
#      url: "https://unsplash.com"


---



## CLI app åŠå…¶ä»£ç å¸ƒå±€

ä¸€ä¸ª CLI åº”ç”¨ç¨‹åºæœ‰å¦‚ä¸‹çš„å‘½ä»¤è¡Œæ“ä½œç•Œé¢ï¼š

```bash
app commands [flags] [arguments]
```

`app` è¡¨ç¤ºè¿™ä¸ªåº”ç”¨ç¨‹åºçš„æ–‡ä»¶åã€‚



### Commands

å¯¹äº `cmdr` æ„å»ºçš„ CLI åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œ`commands` æ˜¯ç”±ä½ å®šä¹‰çš„å­å‘½ä»¤æ„æˆï¼Œä¾‹å¦‚ï¼š

- `app ca print`
- `app ca create`
- `app cert create`



### Flags

`flags` ç”±ä»»æ„å¤šä¸ªæ ‡å¿—ç»„æˆã€‚ä¾‹å¦‚ï¼š

- `app list --retry 5 -rv -n "front-end" --help`

ä½ å¯ä»¥æ··åˆå¤šçº§å­å‘½ä»¤çš„ä»»ä½• `flags`ï¼Œ`cmdr` å°†ä¼šé‡‡ç”¨ä»åº•å±‚åˆ°é¡¶å±‚çš„é¡ºåºå»å°è¯•å®Œæˆ `flags` çš„åŒ¹é…ã€‚å¦‚æœä½ åœ¨å…·æœ‰ä»å±å…³ç³»çš„å­å‘½ä»¤å±‚çº§ä¸­å®šä¹‰äº†ç›¸åŒçš„æ ‡å¿—çš„è¯ï¼Œè¦æ³¨æ„åˆ°é¡¶å±‚çš„æ ‡å¿—å°†æ— æ³•è¢«åŒ¹é…åˆ°ã€‚å¯¹äºè¿™ç±»é‡å¤å®šä¹‰çš„æ ‡å¿—ï¼Œ`cmdr` ä¼šæ‰“å°ä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œæé†’ä½ åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´ç›¸å…³è®¾è®¡ã€‚

> ç›´æ¥å±äºä¸€ä¸ªå‘½ä»¤çš„å­å‘½ä»¤å½¼æ­¤ä¹‹é—´ä¹Ÿä¸èƒ½é‡å¤ï¼ŒåŒæ ·åœ°ä¼šæœ‰ä¸€ä¸ªè­¦å‘Šä¿¡æ¯è¾“å‡ºã€‚



### Arguments

`arguments` è¡¨ç¤ºå½“ `commands`, `flags` è¢«åŒ¹é…å’Œå¤„ç†å®Œæ¯•ä¹‹åï¼Œå‘½ä»¤è¡Œçš„å‰©ä½™å‚æ•°åˆ—è¡¨ã€‚ä¾‹å¦‚ä½ éœ€è¦ä¸€ä¸ªåƒ gcc ä¸€æ ·æ‰€çš„æ–‡ä»¶åˆ—è¡¨ã€‚åœ¨ `cmdr` ä¸­ï¼Œå¾€å¾€ä¼šå°†å…¶ç§°ä½œ `remained args`ï¼Œä½ å¯ä»¥åœ¨ Action æ‰€å®šä¹‰çš„å›è°ƒå‡½æ•°ä¸­ç›´æ¥å–å¾—è¿™ä¸ªæ•°ç»„ï¼š

```go
	root.NewSubCommand("soundex", "snd", "sndx", "sound").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			for ix, s := range args {
				fmt.Printf("%5d. %s => %s\n", ix, s, cmdr.Soundex(s))
			}
			return
		})
```

ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰ä¸€æ¡å‘½ä»¤çš„åŒæ—¶ï¼Œä¹Ÿé€šè¿‡ Action ä¸ºå…¶æŒ‡å®šå“åº”å‡½æ•°ã€‚è¯¥å‡½æ•°è¢«å›è°ƒæ—¶ï¼Œèƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ª `cmd` å¯¹è±¡ä»¥åŠ `remained args` æ•°ç»„ã€‚

> æ­¤æ—¶å¾—åˆ°çš„ `cmd` å¯¹è±¡å®é™…ä¸Šå°±æ˜¯ "soundex" è¿™ä¸ª `*cmdr.Command` å¯¹è±¡ã€‚
>
> å¯¹äºé inline æ–¹å¼å•ç‹¬å®šä¹‰çš„ Action å‡½æ•°æ¥è¯´ï¼Œ`cmd` å¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚è€ƒè™‘å‡ ä¸ªå‘½ä»¤å…±ç”¨åŒä¸€ä¸ª Action å›è°ƒå‡½æ•°çš„æƒ…å†µï¼Œ`cmd` å°†æœ‰åŠ©äºåŒºåˆ«æ˜¯å“ªä¸€ä¸ª Command å¯¹è±¡è¢«å‘½ä¸­äº†ã€‚



### App Layout

ç»¼ä¸Šï¼Œä¸€ä¸ª CLI åº”ç”¨ç¨‹åºçš„å…¸å‹ç¼–ç å¸ƒå±€å¯ä»¥æ˜¯è¿™æ ·ï¼š

```go
package main

import (
	"fmt"
	"github.com/hedzr/cmdr"
	cmdr_examples "github.com/hedzr/cmdr-examples"
	"gopkg.in/hedzr/errors.v2"
)

func main() {
	Entry()
}

func Entry() {
	if err := cmdr.Exec(buildRootCmd(), cmdr.WithUnhandledErrorHandler(onUnhandledErrorHandler)); err != nil {
		fmt.Printf("error: %+v\n", err)
	}
}

func onUnhandledErrorHandler(err interface{}) {
	if cmdr.GetBoolR("enable-ueh") {
		dumpStacks()
		return
	}

	panic(err)
}

func dumpStacks() {
	fmt.Printf("=== BEGIN goroutine stack dump ===\n%s\n=== END goroutine stack dump ===\n", errors.DumpStacksAsString(true))
}

func buildRootCmd() (rootCmd *cmdr.RootCommand) {
	root := cmdr.Root(appName, cmdr_examples.Version).
		Copyright(copyright, "hedzr").
		Description(desc, longDesc).
		Examples(examples)
	rootCmd = root.RootCommand()

	cmdr.NewBool(false).
		Titles("enable-ueh", "ueh").
		EnvKeys("ENABLE_UEH").
		Description("Enables the unhandled exception handler?").
		AttachTo(root)

	soundex(root)
	panicTest(root)

	return
}

func soundex(root cmdr.OptCmd) {
	// soundex

	root.NewSubCommand("soundex", "snd", "sndx", "sound").
		Description("soundex test").
		Group("Test").
		TailPlaceholder("[text1, text2, ...]").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			for ix, s := range args {
				fmt.Printf("%5d. %s => %s\n", ix, s, cmdr.Soundex(s))
			}
			return
		})
}

func panicTest(root cmdr.OptCmd) {
	// panic test

	pa := root.NewSubCommand("panic-test", "pa").
		Description("test panic inside cmdr actions", "").
		Group("Test")

	val := 9
	zeroVal := zero

	pa.NewSubCommand("division-by-zero", "dz").
		Description("").
		Group("Test").
		Action(func(cmd *cmdr.Command, args []string) (err error) {
			fmt.Println(val / zeroVal)
			return
		})

	pa.NewSubCommand("panic", "pa").
		Description("").
		Group("Test").
		Action(raisePanic)
}

func raisePanic(cmd *cmdr.Command, args []string) (err error) {
  panic(9)
  return
}

const (
	appName   = "simple"
	copyright = "simple is an effective devops tool"
	desc      = "simple is an effective devops tool. It make an demo application for `cmdr`."
	longDesc  = "simple is an effective devops tool. It make an demo application for `cmdr`."
	examples  = `
$ {{.AppName}} gen shell [--bash|--zsh|--auto]
  generate bash/shell completion scripts
$ {{.AppName}} gen man
  generate linux man page 1
$ {{.AppName}} --help
  show help screen.
`
	overview = ``

	zero = 0
)
```

è¿™ä¸ªç¤ºä¾‹å¯ä»¥åœ¨ <https://github.com/hedzr/cmdr-examples/blob/master/examples/simple/main.go> è¢«æ‰¾åˆ°ã€‚





ğŸ”š



