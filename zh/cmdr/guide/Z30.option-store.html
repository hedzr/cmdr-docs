<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>选项管理器 (Option Store) | CMDR 文档</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="shortcut icon" type="image/x-icon" href="/cmdr-docs/icons/favicon.ico">
    <link rel="icon" href="/cmdr-docs/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/cmdr-docs/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/cmdr-docs/icons/favicon-16x16.png">
    <link rel="manifest" href="/cmdr-docs/icons/site.webmanifest">
    <link rel="apple-touch-icon" href="/cmdr-docs/icons/apple-touch-icon.png">
    <meta name="description" content="CMDR 文档，开发指南，示例等">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/android-chrome-192x192.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/cmdr-docs/assets/css/0.styles.c125cced.css" as="style"><link rel="preload" href="/cmdr-docs/assets/js/app.593848be.js" as="script"><link rel="preload" href="/cmdr-docs/assets/js/4.5da0fd51.js" as="script"><link rel="preload" href="/cmdr-docs/assets/js/38.108ea613.js" as="script"><link rel="preload" href="/cmdr-docs/assets/js/7.78dbbe62.js" as="script"><link rel="prefetch" href="/cmdr-docs/assets/js/10.6631ec10.js"><link rel="prefetch" href="/cmdr-docs/assets/js/11.017a7178.js"><link rel="prefetch" href="/cmdr-docs/assets/js/12.786b50db.js"><link rel="prefetch" href="/cmdr-docs/assets/js/13.0aef1751.js"><link rel="prefetch" href="/cmdr-docs/assets/js/14.fb9a2937.js"><link rel="prefetch" href="/cmdr-docs/assets/js/15.7e6271d7.js"><link rel="prefetch" href="/cmdr-docs/assets/js/16.9fcb9d82.js"><link rel="prefetch" href="/cmdr-docs/assets/js/17.147a3922.js"><link rel="prefetch" href="/cmdr-docs/assets/js/18.77229f00.js"><link rel="prefetch" href="/cmdr-docs/assets/js/19.528ec23f.js"><link rel="prefetch" href="/cmdr-docs/assets/js/20.725b9ca7.js"><link rel="prefetch" href="/cmdr-docs/assets/js/21.ded297ea.js"><link rel="prefetch" href="/cmdr-docs/assets/js/22.f077707c.js"><link rel="prefetch" href="/cmdr-docs/assets/js/23.a8a8b8bc.js"><link rel="prefetch" href="/cmdr-docs/assets/js/24.91da8249.js"><link rel="prefetch" href="/cmdr-docs/assets/js/25.67b3d72d.js"><link rel="prefetch" href="/cmdr-docs/assets/js/26.ccfbee09.js"><link rel="prefetch" href="/cmdr-docs/assets/js/27.8ebe590d.js"><link rel="prefetch" href="/cmdr-docs/assets/js/28.354e2d56.js"><link rel="prefetch" href="/cmdr-docs/assets/js/29.11c2d4df.js"><link rel="prefetch" href="/cmdr-docs/assets/js/30.422cf996.js"><link rel="prefetch" href="/cmdr-docs/assets/js/31.47f16e08.js"><link rel="prefetch" href="/cmdr-docs/assets/js/32.3c514f0f.js"><link rel="prefetch" href="/cmdr-docs/assets/js/33.a0ba75b3.js"><link rel="prefetch" href="/cmdr-docs/assets/js/34.0b8284f2.js"><link rel="prefetch" href="/cmdr-docs/assets/js/35.e7934f1b.js"><link rel="prefetch" href="/cmdr-docs/assets/js/36.80217456.js"><link rel="prefetch" href="/cmdr-docs/assets/js/37.7d900522.js"><link rel="prefetch" href="/cmdr-docs/assets/js/39.7511c16c.js"><link rel="prefetch" href="/cmdr-docs/assets/js/40.296426cb.js"><link rel="prefetch" href="/cmdr-docs/assets/js/41.1359776f.js"><link rel="prefetch" href="/cmdr-docs/assets/js/42.b8738acd.js"><link rel="prefetch" href="/cmdr-docs/assets/js/5.5d216651.js"><link rel="prefetch" href="/cmdr-docs/assets/js/6.4ddbf92d.js"><link rel="prefetch" href="/cmdr-docs/assets/js/8.cace9542.js"><link rel="prefetch" href="/cmdr-docs/assets/js/9.8db88d53.js"><link rel="prefetch" href="/cmdr-docs/assets/js/vendors~flowchart.f07e9de1.js"><link rel="prefetch" href="/cmdr-docs/assets/js/vendors~notification.5cedef2c.js">
    <link rel="stylesheet" href="/cmdr-docs/assets/css/0.styles.c125cced.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cmdr-docs/zh/" class="home-link router-link-active"><!----> <span class="site-name">CMDR 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cmdr-docs/zh/cmdr/getting-started.html" class="nav-link">
  快速开始
</a></div><div class="nav-item"><a href="/cmdr-docs/zh/cmdr/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Others
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/cmdr-docs/zh/cmdr/faq.html" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/cmdr-docs/zh/cmdr/markdown-demo.html" class="nav-link">
  Markdown Demo
</a></li></ul></li><li class="dropdown-item"><h4>
          Externals
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr-docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR-Docs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr-addons" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR-Addons
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr-examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR-Examples
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cmdr-docs/cmdr/guide/Z30.option-store.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/hedzr/cmdr-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cmdr-docs/zh/cmdr/getting-started.html" class="nav-link">
  快速开始
</a></div><div class="nav-item"><a href="/cmdr-docs/zh/cmdr/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Others
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/cmdr-docs/zh/cmdr/faq.html" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/cmdr-docs/zh/cmdr/markdown-demo.html" class="nav-link">
  Markdown Demo
</a></li></ul></li><li class="dropdown-item"><h4>
          Externals
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr-docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR-Docs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr-addons" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR-Addons
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/hedzr/cmdr-examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMDR-Examples
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cmdr-docs/cmdr/guide/Z30.option-store.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/hedzr/cmdr-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CMDR</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cmdr-docs/zh/cmdr/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/cmdr-docs/zh/cmdr/getting-started.html" class="sidebar-link">快速起步 (Getting Started)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cmdr-docs/zh/cmdr/guide/" aria-current="page" class="sidebar-link">概览 (Overview)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z01.cli-main.html" class="sidebar-link">CLI App 代码布局 (App Layout)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z05.subcommand.html" class="sidebar-link">子命令 (Subcommands)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z06.actions.html" class="sidebar-link">响应函数 (Actions)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z07.flags.html" class="sidebar-link">标志 (Flags)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z15.adv.html" class="sidebar-link">高级特性 (Advanced)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html" aria-current="page" class="active sidebar-link">选项管理器 (Option Store)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#基本定义" class="sidebar-link">基本定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#keypath" class="sidebar-link">keyPath</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#选项-option-和标志-flag-的关系" class="sidebar-link" style="padding-left:3rem;">选项(Option)和标志(Flag)的关系</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#getxxx" class="sidebar-link">GetXXX</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#app-前缀" class="sidebar-link">app 前缀</a></li></ul></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#构造过程" class="sidebar-link">构造过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#来源" class="sidebar-link">来源</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#构造-xref-索引" class="sidebar-link">构造 Xref 索引</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#外部配置文件" class="sidebar-link">外部配置文件</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#控制对配置文件的监视策略" class="sidebar-link" style="padding-left:3rem;">控制对配置文件的监视策略</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#预定义位置" class="sidebar-link" style="padding-left:3rem;">预定义位置</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#更新后处理" class="sidebar-link" style="padding-left:3rem;">更新后处理</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#handlers" class="sidebar-link">Handlers</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#withxrefbuildinghooks" class="sidebar-link" style="padding-left:3rem;">WithXrefBuildingHooks</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#withafterargsparsed" class="sidebar-link" style="padding-left:3rem;">WithAfterArgsParsed</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#withconfigloadedlistener" class="sidebar-link" style="padding-left:3rem;">WithConfigLoadedListener</a></li><li class="sidebar-sub-header"><a href="/cmdr-docs/zh/cmdr/guide/Z30.option-store.html#withautomaticenvhooks" class="sidebar-link" style="padding-left:3rem;">WithAutomaticEnvHooks</a></li></ul></li></ul></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z81.helpers.html" class="sidebar-link">工具函数 (Helpers)</a></li><li><a href="/cmdr-docs/zh/cmdr/guide/Z91.others.html" class="sidebar-link">其它特性 (Others)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cmdr-docs/zh/cmdr/faq.html" class="sidebar-link">FAQ</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="options-store"><a href="#options-store" class="header-anchor">#</a> Options Store</h1> <p>Option Store, 或者 Options Store，管理着一个应用程序的全部配置数据。
这些数据可能来自于环境变量、命令行输入、配置文件，甚至是从外部配置中心装载。它们可以有任意的层级和嵌套关系。它们可以包含布尔量，整数，浮点数，字符串，数组，Map 等多种格式的值。</p> <h2 id="基本定义"><a href="#基本定义" class="header-anchor">#</a> 基本定义</h2> <h3 id="keypath"><a href="#keypath" class="header-anchor">#</a> <code>keyPath</code></h3> <p><code>keyPath</code> 是 <code>Option Store</code> 中的专属概念，一个选项能够被通过 <code>前缀.子命令序列.标志长格式</code> 的方式被访问，这个格式就被称作 <code>keyPath</code>。</p> <p>例如 <code>app.cert.create.cacert</code> 中，app 是内置的前缀，cert.create 代表着 cert 命令及其 create 子命令，cacert 除了是标志的长格式字串之外，也表达出了从属于 cert.create 子命令的含义。</p> <h4 id="选项-option-和标志-flag-的关系"><a href="#选项-option-和标志-flag-的关系" class="header-anchor">#</a> 选项(Option)和标志(Flag)的关系</h4> <p>一个标志（Flag），指的是通过 <code>cmdr.NewBool()</code> 等接口函数定义的实体，这个实体被用于命令行参数的解释，对应着一个特定的命令行参数选项。</p> <p>一个选项（Option），指的是储存在 <code>Option Store</code> 中的一个条目，例如 <code>“app.debug” =&gt; true</code>。</p> <p>一个选项可能和一个标志相关联，但也可能不。但一个标志一定会对应着一个选项。</p> <p>对于 <code>app.debug</code> 这个选项来说，由于 <code>app</code> 是内部设定的选项前缀（所以在体现到标志时不予考虑），故顶级标志 <code>--debug</code> 与其是关联的。它的 yaml 表示能够体现出层级关系：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">app</span><span class="token punctuation">:</span>
  <span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>而对于多级子命令的标志，例如 子命令 <code>cert / create</code> 的标志 <code>--cacert</code>，会对应着 <code>app.cert.create.cacert</code> 这个选项。它的 yaml 表示如同这样：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">app</span><span class="token punctuation">:</span>
  <span class="token key atrule">cert</span><span class="token punctuation">:</span>
    <span class="token key atrule">create</span><span class="token punctuation">:</span>
      <span class="token key atrule">cacert</span><span class="token punctuation">:</span> ca.pem
      <span class="token key atrule">cert</span><span class="token punctuation">:</span> cert.pem
      <span class="token key atrule">key</span><span class="token punctuation">:</span> cert.key
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="getxxx"><a href="#getxxx" class="header-anchor">#</a> <code>GetXXX</code></h3> <p>当使用 <code>GetXXX</code> 来获取选项值时，R版本能够忽略 <code>app</code> 前缀的指定，从而简化你的编程思路。也就是说，<code>GetBoolR(&quot;debug&quot;)</code> 将会取得 <code>app.debug</code> 的布尔量值。</p> <p>一般来说，我们支持如下几种 GetXXX 的变体：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>cmdr<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">&quot;app.server.start.debug&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span>
cmdr<span class="token punctuation">.</span><span class="token function">GetBoolR</span><span class="token punctuation">(</span><span class="token string">&quot;server.start.debug&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span>
cmdr<span class="token punctuation">.</span><span class="token function">GetBoolP</span><span class="token punctuation">(</span><span class="token string">&quot;app.server.start&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span>
cmdr<span class="token punctuation">.</span><span class="token function">GetBoolRP</span><span class="token punctuation">(</span><span class="token string">&quot;server.start&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根据你的上下文代码的便利性，你可以选取最恰当的一种变体。</p> <p>在多数情况下，为了代码逻辑的清晰性，或者 R 变体版本是最佳的选择。</p> <h3 id="app-前缀"><a href="#app-前缀" class="header-anchor">#</a> <code>app</code> 前缀</h3> <p><code>app</code> 前缀是为了在序列化 Option Store 为 YAML 或者其他外部格式时而特别建立的前缀，这样能够保证 Option Store 的序列化内容能够被恰当地包含到外部配置中心里（无论是 YAML，JSON，TOML，抑或是显式的微服务外部配置中心）。</p> <p><code>cmdr.WithOptionsPrefix(prefixes...)</code> 允许你定制前缀，你可以不必使用内置的 <code>app</code> 前缀而是使用 <code>voxr.app-gateway.</code> 作为前缀：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> cmdr<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token function">buildRootCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
              cmdr<span class="token punctuation">.</span><span class="token function">WithOptionsPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;voxr&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;app-gateway&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;error: %+v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>而对于同一个系统 voxr 的 api 服务，则可以使用 <code>voxr.api.</code> 作为前缀：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>cmdr<span class="token punctuation">.</span><span class="token function">WithOptionsPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;voxr&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="构造过程"><a href="#构造过程" class="header-anchor">#</a> 构造过程</h2> <p>Option Store 包含了一整颗键值对的树结构。</p> <p>这棵树是在 cmdr.Exec() 的初始化部分被构造的。</p> <h3 id="来源"><a href="#来源" class="header-anchor">#</a> 来源</h3> <p>Option Store 中的配置数据来自这些地方：</p> <ul><li><p>通过 <code>cmdr.NewBool</code>, <code>cmdr.NewString</code> 等接口定义的命令行标志信息中提供的缺省值。例如：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	cmdr<span class="token punctuation">.</span><span class="token function">NewBool</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Titles</span><span class="token punctuation">(</span><span class="token string">&quot;enable-ueh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ueh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">EnvKeys</span><span class="token punctuation">(</span><span class="token string">&quot;ENABLE_UEH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Description</span><span class="token punctuation">(</span><span class="token string">&quot;Enables the unhandled exception handler?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">AttachTo</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里定义了一个 Bool 类型的标志（Flag），其默认值为 false，如果终端用户没有作出指定，则 Option Store 中会包含该条目且具有 bool 值 false。你可以通过 <code>cmdr.GetBoolR('enable-ueh')</code> 取得该值。</p> <blockquote><p>标志总是带有默认值 false，一般较少会使用 true值。</p> <p>Toggleable Flags Group 例外，通常在组里会有一个 Flag 具有默认值 true。</p></blockquote></li> <li><p>通过命令行参数指定的。例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ go run ./cli --enable-ueh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里会通过命令行将 enable-ueh 的值设置为 true。</p> <p>此时，通过 <code>cmdr.GetBoolR('enable-ueh')</code> 取得的值将会为 true。</p></li> <li><p>通过环境变量指定的。例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">ENABLE_UEH</span><span class="token operator">=</span><span class="token number">1</span> go run /cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果在定义 Flag 是没有通过 <code>.EnvKeys()</code> 指定环境变量名，<code>cmdr</code> 会试图查找自动化命名的环境变量名。例如此例中，自动化的环境变量名应该是 <code>APP_ENABLE_UEH</code>，请参考 <code>cmdr.WithEnvPrefix()</code> 的相关说明。</p></li> <li><p>通过配置文件装入的。例如在主配置文件中包含有如下条目：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token comment"># 这是配置文件的前缀，可以通过 cmdr.WithOptionsPrefix() 自定义</span>
  <span class="token key atrule">simple</span><span class="token punctuation">:</span> <span class="token comment"># 这是通过 cmdr.Root(appName, version) 所指定的应用程序名</span>
    <span class="token key atrule">enable-ueh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   <span class="token comment"># 字段名称应该等于 Flag 的 Full 字段值</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>通过 <code>cmdr.Set(keyPath, value)</code> 设置的。</p></li></ul> <h3 id="构造-xref-索引"><a href="#构造-xref-索引" class="header-anchor">#</a> 构造 Xref 索引</h3> <p>在从来源构建键值对的树状结构的同时，cmdr 也会建立内部使用的索引表。这些索引表有多种用途，其中之一是完善用户定义的数据结构，将各命令、标志以及彼此之间的关联关系构造完整。</p> <p>所以对于 Developers 来说，你可以较为宽松地定义命令或标志，不必太多操心各种细节。</p> <p>例如你可以定义 <code>ToggleGroup(&quot;fruits&quot;)</code>，但可以略过 <code>Group(&quot;fruits&quot;)</code> 定义，因为在 Xref 构造期间这样的缺省关联关系会被自动补全。</p> <h3 id="外部配置文件"><a href="#外部配置文件" class="header-anchor">#</a> 外部配置文件</h3> <p>cmdr 自动查找一系列预定义的路径中符合要求的主配置文件（其文件名应该等于应用程序名，并且带有 .yml|yaml|json|toml 后缀），并自动载入其中的参数定义，同时监视该文件所在位置的名为 <code>conf.d</code> 的子目录中的任何配置文件，只要它们带有 .yml|yaml|json|toml 后缀 。</p> <h4 id="控制对配置文件的监视策略"><a href="#控制对配置文件的监视策略" class="header-anchor">#</a> 控制对配置文件的监视策略</h4> <p>默认时，cmdr 不会监视主配置文件，但 <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L133" target="_blank" rel="noopener noreferrer">WithWatchMainConfigFileToo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 能够改变这一行为。</p> <p><a href="https://pkg.go.dev/github.com/hedzr/cmdr?tab=doc#WithNoWatchConfigFiles" target="_blank" rel="noopener noreferrer">func WithNoWatchConfigFiles(b bool)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以关闭 cmdr 对配置文件或/及其子目录的监视。</p> <p><a href="https://pkg.go.dev/github.com/hedzr/cmdr?tab=doc#WithNoLoadConfigFiles" target="_blank" rel="noopener noreferrer">func WithNoLoadConfigFiles(b bool)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 则完全跳过载入配置文件的环节。</p> <h4 id="预定义位置"><a href="#预定义位置" class="header-anchor">#</a> 预定义位置</h4> <p>默认时，预定位置为如下的数组：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
  <span class="token string">&quot;./ci/etc/%s/%s.yml&quot;</span><span class="token punctuation">,</span>       <span class="token comment">// for developer</span>
  <span class="token string">&quot;/etc/%s/%s.yml&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// regular location</span>
  <span class="token string">&quot;/usr/local/etc/%s/%s.yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// regular macOS HomeBrew location</span>
  <span class="token string">&quot;$HOME/.config/%s/%s.yml&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// per user</span>
  <span class="token string">&quot;$HOME/.%s/%s.yml&quot;</span><span class="token punctuation">,</span>         <span class="token comment">// ext location per user</span>
  <span class="token string">&quot;$THIS/%s.yml&quot;</span><span class="token punctuation">,</span>             <span class="token comment">// executable's directory</span>
  <span class="token string">&quot;%s.yml&quot;</span><span class="token punctuation">,</span>                   <span class="token comment">// current directory</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其中的 <code>$HOME</code>，<code>$THIS</code> 会通过环境变量展开，<code>$THIS</code> 表示执行文件所在的目录。<code>%s</code> 会被展开为 应用程序名。</p> <p>通过 <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L115" target="_blank" rel="noopener noreferrer">WithPredefinedLocations<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 你可以定制这个数组，从而自定义 cmdr 如何去寻找主配置文件，包括当你想要主配置文件不一定采用应用程序名称时，也能从此处进行改变。</p> <h4 id="更新后处理"><a href="#更新后处理" class="header-anchor">#</a> 更新后处理</h4> <p>如果你愿意提供对外部依赖资源（例如 redis 服务）的动态重新初始化的能力的话，通过 <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L154" target="_blank" rel="noopener noreferrer">WithConfigLoadedListener<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以实现这样的特性，当然具体实施依然会是很复杂的，你需要有正确的解决数据竞争的代码逻辑。</p> <h3 id="handlers"><a href="#handlers" class="header-anchor">#</a> Handlers</h3> <h4 id="withxrefbuildinghooks"><a href="#withxrefbuildinghooks" class="header-anchor">#</a> <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L23" target="_blank" rel="noopener noreferrer">WithXrefBuildingHooks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p><code>WithXrefBuildingHooks</code> 可以在 cmdr 的 Xref 索引构造前后设置拦截器。</p> <p>一般的说，后置拦截器是一个很有用的拦截点。因为在这个时候，所有常规途径的命令行参数定义都被预处理过了，所有环境变量值都已经被关联到对应的选项了，所有的外部配置文件中的值都已经被解释并构造到 Option Store 中了。所以此时如果你要追加针对整棵树的操作的话，这里就是最佳的切入点。</p> <h4 id="withafterargsparsed"><a href="#withafterargsparsed" class="header-anchor">#</a> <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L387" target="_blank" rel="noopener noreferrer">WithAfterArgsParsed<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>cmdr 在 Xref 索引构建完成之后会开始解释命令行参数。而当命令行参数被有效地解释之后，<a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L387" target="_blank" rel="noopener noreferrer">WithAfterArgsParsed<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 所定义的回调函数将获得执行机会，如果回调函数无错地返回，则 cmdr 将会转去执行已经命中的 子命令的响应函数（Action），否则的话 cmdr 放弃进一步操作退出应用程序。</p> <p>所以这里可以做全局的身份鉴定，参数有效性验证等操作——根据你的实际需要。</p> <h4 id="withconfigloadedlistener"><a href="#withconfigloadedlistener" class="header-anchor">#</a> <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L154" target="_blank" rel="noopener noreferrer">WithConfigLoadedListener<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在 cmdr 执行命中子命令的 Action 函数的过程中，外部配置文件也处于被监视的状态中。如果外部配置文件发生了变化，那么对应的文件将被自动载入并合并到 <code>Option Store</code> 的现有参数树中，然后 <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L154" target="_blank" rel="noopener noreferrer">WithConfigLoadedListener<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 所指定的回调函数将会获得一个阐述这些变更的机会。</p> <p>如果你愿意提供对外部依赖资源（例如 redis 服务）的动态重新初始化的能力的话，通过 <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L154" target="_blank" rel="noopener noreferrer">WithConfigLoadedListener<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以实现这样的特性，当然具体实施依然会是很复杂的，你需要有正确的解决数据竞争的代码逻辑。</p> <h4 id="withautomaticenvhooks"><a href="#withautomaticenvhooks" class="header-anchor">#</a> <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L37" target="_blank" rel="noopener noreferrer">WithAutomaticEnvHooks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在外部配置文件被解释之后，cmdr 的初始化代码也会扫描环境变量并完成映射。</p> <p>在完成了匹配的环境变量的映射操作之后， <a href="https://github.com/hedzr/cmdr/blob/v1.6.49/exec_with_options.go#L37" target="_blank" rel="noopener noreferrer">WithAutomaticEnvHooks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 所指定的回调函数会获得执行机会。你可以借助这个回调函数对默认的映射结果进行审视。</p> <p>🔚</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/hedzr/cmdr-docs/edit/master/docs/zh/cmdr/guide/Z30.option-store.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/22/2020, 12:10:51 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cmdr-docs/zh/cmdr/guide/Z15.adv.html" class="prev">
        高级特性 (Advanced)
      </a></span> <span class="next"><a href="/cmdr-docs/zh/cmdr/guide/Z81.helpers.html">
        工具函数 (Helpers)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/cmdr-docs/assets/js/app.593848be.js" defer></script><script src="/cmdr-docs/assets/js/4.5da0fd51.js" defer></script><script src="/cmdr-docs/assets/js/38.108ea613.js" defer></script><script src="/cmdr-docs/assets/js/7.78dbbe62.js" defer></script>
  </body>
</html>
